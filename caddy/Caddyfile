(tinyauth_forwarder) {
    forward_auth tinyauth:3000 {
        uri /api/auth/caddy
        copy_headers Remote-User Remote-Name Remote-Email Remote-Groups
    }
}

(authentik_forwarder) {
    reverse_proxy /outpost.goauthentik.io/* authentik-server:9000
    forward_auth authentik-server:9000 {
        uri /outpost.goauthentik.io/auth/caddy
        copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
        trusted_proxies private_ranges
    }
}

http://auth.{$MY_DOMAIN} {
    reverse_proxy tinyauth:3000
}

http://tasks.{$MY_DOMAIN} {
    reverse_proxy vikunja:3456
}

http://nextcloud.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy nextcloud:443 {
        transport http {
            tls_insecure_skip_verify
        }
    }
}

http://actual.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy actual_server:5006
}

http://dozzle.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy dozzle:8080
}

http://pdf.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy stirling-pdf:8080
}

http://backrest.{$MY_DOMAIN} {
    import authentik_forwarder
    reverse_proxy backrest:9898
}

http://homepage.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy homepage:3000
}

http://{$MY_DOMAIN} {
    handle /static/* {
        root * /srv/blog
        file_server
    }
    
    handle /media/* {
        root * /srv/blog
        file_server
    }
    
    handle /admin* {
        import tinyauth_forwarder
        reverse_proxy blog:8000
    }
    
    reverse_proxy blog:8000
}

http://llm.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy open-webui:8080
}

http://n8n.{$MY_DOMAIN} {
    import tinyauth_forwarder
    reverse_proxy n8n:5678
}

http://authentik.{$MY_DOMAIN} {
    reverse_proxy authentik-server:9000
}

